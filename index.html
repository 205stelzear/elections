<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Élections Scoutes</title>
	
	<link rel="icon" href="./images/envelope.png">
	
	<link rel="stylesheet" href="./css/libraries/bootstrap.min.css">
	<link rel="stylesheet" href="./css/style.css">
	
	<script src="./js/libraries/jquery-3.4.1.min.js"></script>
	<script src="./js/libraries/popper.min.js"></script>
	<script src="./js/libraries/bootstrap.min.js"></script>
	
	<script src="./js/libraries/FileSaver.min.js"></script>
	<script src="./js/libraries/bootstrap-input-spinner.min.js"></script>
	<script src="./js/libraries/lz-string.min.js"></script>
</head>

<body class="d-flex">
	
	<div id="voting-voted-overlay" class="position-fixed w-100 h-100 d-flex">
		
		<div class="touch-skipper w-100 h-50 fixed-top"></div>
		
		<div class="m-auto text-center">
			<img id="success-img" src="./images/success.png" width="25%" class="m-auto">
			<h1 class="display-1">Votes enregistrés!</h1>
			<h2 class="display-3">Merci!</h2>
		</div>
		
	</div>
	
	<div id="voting-toasts-container" class="fixed-top w-100 d-flex flex-column p-4 i-am-away" style="z-index: 99999;">
		<div class="toast mx-auto" role="alert" data-delay="1500">
			<div class="toast-header">
				<strong class="mr-auto text-primary">Nombre électeur(s) restant</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="toast-body text-center">
				<p class="shared-election-container" hidden>
					Code élection partagée : <u style="font-family: monospace;"><span class="shared-election-code h4 text-primary"></span></u>
				</p>
				<p id="voters-remaining-count-toast">
					<!-- Text will be set here dynamically -->
				</p>
				<p id="seats-remaining-count-toast" class="shared-election-container" hidden>
					<!-- Text will be set here dynamically -->
				</p>
				<button type="submit" id="voting-skip-button" class="btn btn-primary">Sauter les votes</button>
			</div>
		</div>
	</div>
	
	<div id="views" class="container py-3">
		
		<div id="home-page" class="text-center h-100">
			
			<div class="d-flex flex-column h-100">
				
				<h1 class="display-1 pt-5">Élections Scoutes</h1>
				
				<div class="flex-grow-1">
					<div class="h-100 d-flex align-items-center justify-content-center">
						<div class="d-flex flex-column w-100">
							
							<noscript>
								<div class="mb-5">
									<h3 class="display-4 text-danger" style="font-size: 3rem">Javascript a besoin d'être activé pour le fonctionnement de cette application!</h3>
								</div>
							</noscript>
							
							<button type="button" id="home-new-button" class="btn btn-success btn-lg" disabled>Nouvelles Élections</button>
							
							<button type="button" id="home-join-button" class="btn btn-success btn-lg mt-5" data-toggle="modal" data-target="#home-join-election-modal" disabled>Rejoindre une Élection Partagée</button>
							
							<div id="database-loader-zone" class="loader mt-5 is-popable-hover loader-disabled" data-placement="bottom">
								<div class="loader-input">
									<input id="loader-file-input" class="loader-file" type="file" name="file" accept=".json" disabled />
									<label for="loader-file-input" class="h-100 w-100 p-5 m-0"><strong>Cliquez dans cette boite pour choisir une base de données (fichier json)</strong><span class="loader-dragndrop"> ou glissez la ici</span>.</label>
								</div>
							</div>
							
						</div>
					</div>
				</div>
				
			</div>
			
			<div class="modal fade" id="home-join-election-modal" tabindex="-1" role="dialog" aria-labelledby="home-join-election-modal-title" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="home-join-election-modal-title">Rejoindre une Élection Partagée</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body text-left">
							<form>
								<div class="form-group">
									<label for="recipient-name" class="col-form-label">Code de l'Élection Partagée :</label>
									<div class="container mt-2">
										<div class="row input-partition" data-hidden-input-id="fullCodeValue" style="font-family: monospace; font-size: 2rem;">
											<input type="text" class="text-capitalize" pattern="[a-zA-Z1-9]" data-do-replace="true" maxlength="1">
											<input type="text" class="text-capitalize" pattern="[a-zA-Z1-9]" data-do-replace="true" maxlength="1">
											<input type="text" class="text-capitalize" pattern="[a-zA-Z1-9]" data-do-replace="true" maxlength="1">
											<input type="text" class="text-capitalize" pattern="[a-zA-Z1-9]" data-do-replace="true" maxlength="1">
											<input type="text" class="text-capitalize" pattern="[a-zA-Z1-9]" data-do-replace="true" maxlength="1">
											<input type="text" class="text-capitalize" pattern="[a-zA-Z1-9]" data-do-replace="true" maxlength="1">
										</div>
									</div>
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
							<button id="home-join-election-modal-button" type="button" class="btn btn-primary">Rejoindre Élection</button>
						</div>
					</div>
				</div>
			</div>
			
		</div>
		
		<div id="setup-page" class="h-100" hidden>
			
			<div class="position-absolute" style="top: 0; left: 0;">
				<button type="submit" id="setup-homepage-button" class="btn btn-secondary mt-3 mt-xl-5 ml-3 ml-xl-5">Retour à la page d'accueil</button>
			</div>
			
			<h2 class="display-2 text-center pt-5 pt-lg-4 pb-3">Préparation élections Scoutes</h2>
			
			<form id="setup-form" class="w-100">
				<div class="form-group row">
					<div class="col-sm-3 col-md-5 col-lg-4">
						<label class="col-form-label" for="db-name">Nom de la base de données</label>
					</div>
					<div class="col-sm-9 col-md-7 col-lg-8 align-self-center">
						<input type="text" class="form-control is-invalid is-popable" id="db-name" aria-describedby="dbName" name="dbName" data-placement="top" autocomplete="off" spellcheck="false" required>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-12 col-sm-3 col-md-5 col-lg-4">
						<label class="col-form-label" for="db-psw">
							Mot de passe de la base de données&nbsp;<span class="col-form-label is-popable-hover" data-placement="auto" data-html="true" data-title="<span class='text-danger'>Avertissement!</span>" data-content="Le mot de passe n'est pas sécurisé : ceci n'est qu'un mur pour empêcher les jeunes de voir les résultats si jamais l'appareil est déplacé dans le local lorsque la session de vote est terminé, par exemple.<br>Veuillez <strong>ne pas</strong> utiliser de mot de passe sensible que vous utilisez à tout les jours!">&#9888;</span>
						</label>
					</div>
					<div class="col-12 col-sm-9 col-md-7 col-lg-8 d-flex flex-row align-self-center">
						<input type="password" class="form-control" id="db-psw" aria-describedby="dbPsw" name="dbPsw" data-placement="top" autocomplete="off" spellcheck="false" placeholder="(optionnel)">
						<div class="ml-2">
							<input type="checkbox" id="password-visible" name="passwordVisible" class="boot-checkbox checkbox-eye">
							<label for="password-visible"></label>
						</div>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-sm-3 col-md-5 col-lg-4">
						<label class="col-form-label" for="number-of-voters">Nombre d'électeurs</label>
					</div>
					<div class="col-sm-9 col-md-7 col-lg-8 align-self-center">
						<input type="number" class="form-control spinner is-invalid is-popable" id="number-of-voters" min="1" max="9999" aria-describedby="numberOfVoters" name="numberOfVoters" data-placement="top" required>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-sm-3 col-md-5 col-lg-4 align-self-center">
						<label class="col-form-label" for="number-of-votes">Nombre de votes par électeur</label>
					</div>
					<div class="col-sm-9 col-md-7 col-lg-8 row pr-0 align-items-center">
						<div class="col-4 col-lg-2 py-0 col-form-label">
							<label class="col-form-label" for="number-of-votes-minimum">Minimum&nbsp;:</label>
						</div>
						<div class="col-8 col-lg-4 pr-0">
							<input type="number" class="form-control spinner is-invalid is-popable" id="number-of-votes-minimum" min="0" max="9999" name="numberOfVotesMin" data-placement="top" required>
						</div>
						<div class="col-4 col-lg-2 py-0 col-form-label mt-3 mt-lg-0">
							<label class="col-form-label" for="number-of-votes-maximum">Maximum&nbsp;:</label>
						</div>
						<div class="col-8 col-lg-4 mt-3 mt-lg-0 pr-0">
							<input type="number" class="form-control spinner is-invalid is-popable" id="number-of-votes-maximum" min="1" max="9999" name="numberOfVotesMax" data-placement="top" required>
						</div>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-12 col-md-6 border-right border-right-no-medium d-flex flex-row justify-content-between">
						<label class="col-form-label is-popable-hover" data-placement="top" data-content="Permet de voter plusieurs fois pour le même candidat. Par défaut, un candidat ne peut avoir qu'un seul vote (case décochée).">Multiple votes par candidat</label>
						<div>
							<input type="checkbox" id="allow-multiple-same-candidate" name="allowMultipleSameCandidate" class="boot-checkbox">
							<label for="allow-multiple-same-candidate"></label>
						</div>
					</div>
					<div class="col-12 col-md-6 d-flex flex-row justify-content-between">
						<label class="col-form-label is-popable-hover" data-placement="top" data-content="Permet de télécharger la base de données automatiquement pendant le vote si la page se ferme ou se fait rafraichir. Coché par défaut (recommandé).">Télécharger la bd automatiquement</label>
						<div>
							<input type="checkbox" id="auto-download-db" name="autoDownloadDb" class="boot-checkbox" checked>
							<label for="auto-download-db"></label>
						</div>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-12 col-md-6">
						<div id="image-loader-zone" class="loader is-popable-hover" data-placement="bottom">
							<div class="loader-input">
								<input id="image-loader-input" class="loader-file" type="file" name="file" accept="image/*" />
								<label for="image-loader-input" class="h-100 w-100 p-3 m-0 text-center"><strong>Cliquez dans cette boite pour choisir une image de groupe (optionnelle)</strong><span class="loader-dragndrop"> ou glissez la ici</span>.</label>
							</div>
						</div>
					</div>
					<div class="col-12 col-md-6 mt-3 mt-md-0 d-flex flex-row align-self-center justify-content-center">
						<div class="w-100">
							<div class="border border-success text-center d-flex align-items-center justify-content-center h-100 election-group-image">
								<img id="setup-preview-image" src="./images/no_image.png" class="img-fluid d-block" alt="Image preview..." style="max-height: 82px;">
							</div>
						</div>
						<div class="d-flex align-items-center justify-content-center ml-3">
							<button id="setup-preview-image-closer" type="button" class="btn btn-outline-danger is-popable-hover" data-placement="top" data-content="Enlever l'image choisie." disabled>
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
					</div>
				</div>
				<div class="pb-2 pb-md-3">
					<div id="candidate-controls-1" class="form-group row mb-2 mb-md-3">
						<div class="col-sm-3 col-md-2">
							<label class="col-form-label" for="candidate-name-1">Candidat 1</label>
						</div>
						<div class="col-sm-9 col-md-10">
							<input type="text" class="form-control is-invalid is-popable" id="candidate-name-1" aria-describedby="candidate-1" placeholder="Nom" name="candidate-name-1" data-placement="top" data-candidatenumber="1" autocomplete="off" required>
						</div>
					</div>
					<div id="setup-candidates">
						<!-- More inputs will dynamically be added here -->
					</div>
				</div>
				<div class="row mt-1 mt-md-0 mb-4 mx-auto justify-content-center d-flex flex-md-row flex-row-reverse">
					<div class="mt-2 mt-md-0 col-auto px-3 px-md-0">				
						<button id="candidate-add" class="btn btn-secondary mx-auto mx-md-0" data-candidatecount="1">Ajouter Candidat</button>
					</div>
					<div class="mt-2 mt-md-0 mr-md-0 ml-md-5 col-auto px-3 px-md-0">
						<button id="candidate-remove" class="btn btn-danger mx-auto mx-md-0" disabled="">Enlever dernier Candidat</button>
					</div>
				</div>
				<div class="row">
					<div class="col-12 col-md-6">
						<button type="submit" id="setup-submit-button" class="btn btn-lg btn-block btn-primary" disabled>Créer l'Élection</button>
					</div>
					<div class="col-12 col-md-6 mt-3 mt-md-0">
						<button type="submit" id="setup-shared-submit-button" class="btn btn-lg btn-block btn-primary" disabled>Créer comme Élection Partagée</button>
					</div>
				</div>
			</form>
			
		</div>
		
		<div id="pre-voting-page" class="h-100" hidden>
			
			<div class="d-flex flex-column h-100">
				
				<h2 class="display-2 pt-2 pt-md-5 text-center">Rappel : Vote Scouts</h2>
				
				<div class="flex-grow-1">
					<div class="h-100 d-flex flex-column justify-content-center">
						
						<div class="mb-auto mt-sm-5">
							<div class="my-3 mt-sm-0 text-center d-flex align-items-center justify-content-center election-group-image">
								<img src="" class="img-fluid" alt="Image preview..." style="height: 20vw; max-height: 200px;">
							</div>
						</div>
						
						<div class="container-fluid pb-md-5 mb-auto">
							
							<div class="row mb-3 border-bottom shared-election-container" hidden>
								<p class="h3">Voici le code de votre élection partagée : <u style="font-family: monospace;"><span class="shared-election-code h2 text-primary"></span></u>.</p>
								<p>Veuillez prendre note qu'il ne peut pas avoir le chiffre <em>zéro</em> dans ce code pour éviter la confusion entre <span style="font-family: monospace;">0</span> (zéro) et <span style="font-family: monospace;">O</span> (lettre "O").</p>
							</div>
							<div class="row text-center justify-content-center mb-2">
								<p class="h4">Ceci est un rappel du fonctionnement lors de la session de vote :</p>
							</div>
							<div class="row text-justify justify-content-center">
								<span>
									Pour passer à un prochain électeur, lorsque l'écran est <span id="pre-voting-overlay-color">vert</span> et affiche "<span class="font-italic">Votes enregistrés</span>", vous pouvez appuyer sur la <span class="font-weight-bold">barre d'espace</span> sur votre clavier.
									<br>
									Ceci affichera de plus une notification en haut de l'écran affichant le nombre d'électeurs restant. Cette notification s'affichera à chaque fois que la barre d'espace sera appuyée, même pendant qu'un vote est en cours!
								</span>
							</div>
							<div id="pre-voting-touchscreen-reminder" class="row text-justify justify-content-center mt-2 pt-2 border-top" hidden>
								<span>De plus, puisque vous avez un écran tactile, dans ce même écran, vous pouvez appuyer le <span class="font-weight-bold">haut de l'écran (la moitié supérieure)</span> pendant quelques instants pour passer aussi au prochain électeur (particulièrement utile pour les appareils n'ayant pas de claviers de connecté).</span>
							</div>
							<div class="row text-center justify-content-center mt-4" style="font-size: 1.2rem;">
								<span>Bonnes élections!</span>
							</div>
							<div class="row text-center mt-4 justify-content-center">
								<button type="submit" id="pre-voting-submit-button" class="btn btn-primary">Débuter la session de votes</button>
							</div>
							
						</div>
						
					</div>
				</div>
				
			</div>
			
		</div>
		
		<div id="voting-page" class="h-100" hidden>
			<div class="d-flex flex-column h-100 justify-content-center">
				
				<div class="mb-auto">
					<div class="my-3 mb-sm-0 text-center d-flex align-items-center justify-content-center election-group-image">
						<img src="" class="img-fluid" alt="Image preview..." style="height: 20vw; max-height: 200px;">
					</div>
				</div>
				
				<div class="mb-auto">
					
					<div id="cards-container" class="w-100 mb-3">
						<!-- Will be filled dynamically with candidates cards -->
					</div>
					
					<div class="w-100">
						<p id="voting-remaining-text-absolute" class="lead text-center" hidden>
							Nombre de vote restant : <span id="voting-remaining-count" class="font-weight-bold"></span>
						</p>
						<p id="voting-remaining-text-multiple" class="lead text-center" hidden>
							Nombre de vote minimum restant : <span id="voting-remaining-count-min" class="font-weight-bold"></span>
							<br>
							Nombre de vote maximum restant : <span id="voting-remaining-count-max" class="font-weight-bold"></span>
						</p>
						<button type="button" id="voting-submit-button" class="btn btn-success btn-lg btn-block" disabled>Enregistrer</button>
					</div>
					
				</div>
				
			</div>
		</div>
		
		<div id="pre-results-page" class="h-100" hidden>
			
			<div class="d-flex flex-column h-100">
				
				<h2 class="display-2 pt-5 text-center">Résultats Élections Scoutes</h2>
				
				<div class="flex-grow-1">
					<div class="h-100 d-flex flex-column justify-content-center">
						
						<div class="mb-auto">
							<div class="my-3 mb-sm-0 text-center d-flex align-items-center justify-content-center election-group-image">
								<img src="" class="img-fluid" alt="Image preview..." style="height: 20vw; max-height: 200px;">
							</div>
						</div>
						
						<div class="mb-auto">
							
							<form id="pre-results-form" class="w-100">
								<div class="form-group px-2 px-md-0">
									<label for="pre-results-password-input">Mot de passe pour afficher les résultats</label>
									<input type="text" class="form-control my-3" id="pre-results-password-input" placeholder="Mot de passe" autocomplete="off">
								</div>
								<div class="w-100 text-center mt-4">
									<button type="submit" id="pre-results-submit-button" class="btn btn-primary">Soumettre</button>
								</div>
							</form>
							
						</div>
						
					</div>
				</div>
				
			</div>
			
		</div>
		
		<div id="results-page" class="h-100" hidden>
			
			<div class="position-absolute" style="top: 0; left: 0;">
				<button type="submit" id="results-homepage-button" class="btn btn-secondary mt-3 mt-lg-5 ml-3 ml-lg-5">Retour à la page d'accueil</button>
			</div>
			
			<div class="d-flex flex-column h-100">
				
				<h2 class="display-2 pt-5 text-center">Résultats Élections Scoutes</h2>
				
				<div class="flex-grow-1">
					<div class="h-100 d-flex flex-column justify-content-center">
						
						<div class="mb-auto">
							<div class="my-3 mb-sm-0 text-center d-flex align-items-center justify-content-center election-group-image">
								<img src="" class="img-fluid" alt="Image preview..." style="height: 20vw; max-height: 100px;">
							</div>
						</div>
						
						<div class="container-fluid mb-auto">
							
							<div class="row mb-3 justify-content-center">
								<div class="container-fluid">
									<div class="row justify-content-center">
										<span>Petit rappel que vous pouvez cliquer les lignes, ce qui les changera couleurs <span id="results-click-explications" class="collapse collapsible">de aucune couleur à jaune à vert (et revenir à aucune couleur par la suite), lesquels vous pourriez associer ces couleurs comme une sélection (par exemple, jaune est un candidat potentiel, vert un candidat choisit).</span><span class="collapse-ellipsis">...</span></span>
									</div>
									<div class="row justify-content-center">
										<u><a class="text-monospace" data-toggle="collapse" data-target="#results-click-explications">Plus</a></u>
									</div>
								</div>
							</div>
							<div class="row">
								<table class="table table-striped table-hover table-border">
									<thead class="thead-light">
										<tr>
											<th scope="col" width="5%">#</th>
											<th scope="col" width="5%">Position</th>
											<th scope="col">Candidat</th>
											<th scope="col">Nombre de votes</th>
										</tr>
									</thead>
									<tbody id="results-body">
										<!-- Will be filled dynamically with candidates voting results -->
									</tbody>
								</table>
							</div>
							
						</div>
						
					</div>
				</div>
				
				<button type="submit" id="results-download-button" class="btn btn-lg btn-primary">Sauvegarder la base de données</button>
				
			</div>
			
		</div>
		
	</div>
	
	<script src="./js/utilities.js"></script>
	<script src="./js/switcher.js"></script>
	<script src="./js/index.js"></script>
	<script src="./js/results.js"></script>
	<script src="./js/voting.js"></script>
	<script src="./js/setup.js"></script>
	
</body>

</html>
